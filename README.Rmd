---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# AICcPerm

<!-- badges: start -->
[![R-CMD-check](https://github.com/Sustainscapes/AICcPerm/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/Sustainscapes/AICcPerm/actions/workflows/R-CMD-check.yaml)
<!-- badges: end -->

The goal of AICcPerm is to generate an R package that does model selection for Permanovas from the vegan packages, to install this package you can use the remotes package and intall it as this:

```{r, eval= F}
remotes::install_github("Sustainscapes/AICcPerm")
```


## Generation of all possible models

For the generation of all possible models you can use the `make_models` function, just as in this example

```{r examplemakemodels, results='hide', message=FALSE}
library(AICcPerm)
AllModels <- make_models(vars = c("pH", "Sand", "Clay"), ncores = 2)
```

This will give you the following table:

```{r Table1, echo = F}
knitr::kable(AllModels)
```

Where you can see all possible models for tose 3 variables.

## AICc calculation

for this you can use the `AICc_permanova2`, this is an example of this:

```{r}

library(vegan)
data(dune)
data(dune.env)

# Run PERMANOVA using adonis2

Model <- adonis2(dune ~ Management*A1, data = dune.env)

# Calculate AICc
Table_permanova <- AICc_permanova2(Model)
```

This is shown in the following table

```{r permanovatable}
knitr::kable(Table_permanova)
```

## Full example

We will show the last function called `fit_models`, we will start by using the datasets from the vegan package:

```{r}
library(vegan)
data(dune)
data(dune.env)
```

And then generate all possible models for 3 of the variables:

```{r, results='hide'}
AllModels <- make_models(vars = c("A1", "Moisture", "Manure"))
```

We then get this table:

```{r, echo=FALSE}
knitr::kable(AllModels)
```

After this, we make a model selection by fitting all possible models:

```{r}
Fitted <- fit_models(all_forms = AllModels,
           veg_data = dune,
           env_data = dune.env,
           ncores = 4,
           method = "bray")
```

Which results in the following table:

```{r, echo=FALSE}
knitr::kable(Fitted)
```

If there is a block variable to be used, for example `Management` in the `dune.env` object, you can change the above code by using the `strata` argument:

```{r fitwihtstrata}
Fitted2 <- fit_models(all_forms = AllModels,
           veg_data = dune,
           env_data = dune.env,
           ncores = 4,
           method = "bray",
           strata = "Management")
```

Which results in the following table:

```{r, echo=FALSE}
knitr::kable(Fitted2)
```


